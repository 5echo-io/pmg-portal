{% load static i18n %}
<!doctype html>
<html lang="{{ current_language_code|default:'en' }}">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% trans "Login" %} | {% trans "PMG Portal" %}</title>
  <link rel="stylesheet" href="{% static 'app.css' %}">
</head>
<body class="page">
  <div class="card">
    <h1>{% trans "PMG Portal" %}</h1>
    <p class="muted">{% trans "Sign in to continue." %}</p>

    <form method="post" id="login-form">
      {% csrf_token %}
      <label>{% trans "Email" %}</label>
      {{ form.username }}

      <label>{% trans "Password" %}</label>
      {{ form.password }}

      {% if form.non_field_errors %}
        <div class="alert">{{ form.non_field_errors }}</div>
      {% endif %}

      <div class="signin-btn-wrap" id="signin-btn-wrap">
        <button type="submit" id="signin-btn" disabled>{% trans "Sign in" %}</button>
      </div>
    </form>

    <div class="row row--centered">
      <a href="/account/register/" class="auth-link">{% trans "Create account" %}</a>
    </div>
  </div>
  <div class="login-page-footer">
    <div class="login-footer-right">
      <span class="login-footer-version">{{ app_version|default:"Unknown" }}</span>
      <div class="login-lang-dropdown" id="login-lang-dropdown">
        <button type="button" class="login-lang-trigger" id="login-lang-trigger" aria-haspopup="listbox" aria-expanded="false" aria-label="{% trans 'Select language' %}">
          <span class="user-menu-lang-flag" aria-hidden="true">
            {% if current_language_code == 'nb' %}
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" viewBox="0 0 22 16"><rect width="22" height="16" fill="#ba0c2f"/><rect x="6" y="0" width="4" height="16" fill="#fff"/><rect x="0" y="6" width="22" height="4" fill="#fff"/><rect x="7" y="0" width="2" height="16" fill="#00205b"/><rect x="0" y="7" width="22" height="2" fill="#00205b"/></svg>
            {% else %}
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" viewBox="0 0 60 30" fill="none"><rect width="60" height="30" fill="#012169"/><path d="M0 0l60 30M60 0L0 30" stroke="#fff" stroke-width="6"/><path d="M0 0l60 30M60 0L0 30" stroke="#C8102E" stroke-width="4"/><path d="M30 0v30M0 15h60" stroke="#fff" stroke-width="10"/><path d="M30 0v30M0 15h60" stroke="#C8102E" stroke-width="6"/></svg>
            {% endif %}
          </span>
          <span class="login-lang-trigger-label">{{ current_language_name }}</span>
          <svg class="login-lang-chevron" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="login-lang-menu" id="login-lang-menu" role="listbox" aria-hidden="true">
          {% for lang in other_languages %}
          <form method="post" action="{% url 'set_language_custom' %}" class="login-lang-option-form">
            {% csrf_token %}
            <input type="hidden" name="language" value="{{ lang.code }}">
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button type="submit" class="login-lang-option" role="option">
              {% if lang.code == 'nb' %}
              <span class="user-menu-lang-flag" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" viewBox="0 0 22 16"><rect width="22" height="16" fill="#ba0c2f"/><rect x="6" y="0" width="4" height="16" fill="#fff"/><rect x="0" y="6" width="22" height="4" fill="#fff"/><rect x="7" y="0" width="2" height="16" fill="#00205b"/><rect x="0" y="7" width="22" height="2" fill="#00205b"/></svg></span>
              {% else %}
              <span class="user-menu-lang-flag" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" viewBox="0 0 60 30" fill="none"><rect width="60" height="30" fill="#012169"/><path d="M0 0l60 30M60 0L0 30" stroke="#fff" stroke-width="6"/><path d="M0 0l60 30M60 0L0 30" stroke="#C8102E" stroke-width="4"/><path d="M30 0v30M0 15h60" stroke="#fff" stroke-width="10"/><path d="M30 0v30M0 15h60" stroke="#C8102E" stroke-width="6"/></svg></span>
              {% endif %}
              <span>{{ lang.name }}</span>
            </button>
          </form>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <script>
    (function() {
      var form = document.getElementById('login-form');
      var btn = document.getElementById('signin-btn');
      if (!form || !btn) return;
      var email = form.querySelector('input[name="username"], input[type="email"]');
      var pass = form.querySelector('input[name="password"]');
      var wrap = document.getElementById('signin-btn-wrap');
      function check() {
        var e = (email && email.value.trim()) || '';
        var p = (pass && pass.value) || '';
        var ready = e.length > 0 && p.length > 0;
        btn.disabled = !ready;
        btn.classList.toggle('ready', ready);
        if (wrap) wrap.classList.toggle('ready', ready);
      }
      if (email) email.addEventListener('input', check);
      if (email) email.addEventListener('change', check);
      if (pass) pass.addEventListener('input', check);
      if (pass) pass.addEventListener('change', check);
      check();
    })();
    (function() {
      var trigger = document.getElementById('login-lang-trigger');
      var menu = document.getElementById('login-lang-menu');
      var wrap = document.getElementById('login-lang-dropdown');
      if (!trigger || !menu || !wrap) return;
      trigger.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        var open = menu.getAttribute('aria-hidden') !== 'true';
        menu.setAttribute('aria-hidden', open ? 'true' : 'false');
        trigger.setAttribute('aria-expanded', open ? 'false' : 'true');
      });
      wrap.addEventListener('mouseleave', function() {
        menu.setAttribute('aria-hidden', 'true');
        trigger.setAttribute('aria-expanded', 'false');
      });
      document.addEventListener('click', function(e) {
        if (!wrap.contains(e.target)) {
          menu.setAttribute('aria-hidden', 'true');
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
    })();
  </script>
</body>
</html>
