{% extends "admin_app/base.html" %}
{% load i18n %}

{% block admin_title %}{{ device_type.name }}{% endblock %}
{% block breadcrumb_back %}<a href="{% url 'admin_app:admin_device_list' %}" class="breadcrumb-back-btn" aria-label="{% trans 'Back to Devices' %}">← {% trans "Devices" %}</a>{% endblock %}
{% block breadcrumb_extra %}
<span class="breadcrumb-sep">→</span> <a href="{% url 'admin_app:admin_device_type_list' %}">{% trans "Devices" %}</a>
<span class="breadcrumb-sep">→</span> <span>{{ device_type.name }}</span>
{% endblock %}

{% block admin_content %}
<div class="device-detail-card" style="display: flex; gap: 24px; align-items: flex-start; margin-bottom: 24px;">
  <div class="customer-logo-upload-area" style="cursor: default; flex-shrink: 0;">
    {% if device_type.product_image %}
    <img src="{{ device_type.product_image.url }}" alt="{{ device_type.name }}" style="max-width: 120px; max-height: 120px; object-fit: contain;">
    {% else %}
    <div class="customer-logo-placeholder">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><path d="M16 2v20M8 2v20M2 12h20"/></svg>
      <span>{% trans "Product" %}</span>
    </div>
    {% endif %}
  </div>
  <div style="flex: 1; min-width: 0;">
    <h1 class="admin-page-title" style="margin-top: 0;">{{ device_type.name }}</h1>
    <p class="muted" style="margin: 0;">
      {{ device_type.get_category_display_full }}
      {% if device_type.get_manufacturer_display or device_type.model %} · {{ device_type.get_manufacturer_display|default:"" }}{% if device_type.model %} {{ device_type.model }}{% endif %}{% endif %}
    </p>
    {% if device_type.description %}
    <p class="muted" style="margin-top: 8px;">{{ device_type.description }}</p>
    {% endif %}
  </div>
  <div style="flex-shrink: 0; display: flex; gap: 8px; align-items: flex-start;">
    <a href="{% url 'admin_app:admin_device_type_edit' device_type.slug %}" class="admin-btn-sm form-btn-secondary">{% trans "Edit product" %}</a>
    <a href="{% url 'admin_app:admin_device_instance_add' device_type.slug %}" class="admin-toolbar-add-btn">{% trans "Add instance" %}</a>
  </div>
</div>
{% with first_datasheet=device_type.datasheets.first %}
{% if first_datasheet %}
<p class="muted">{% trans "Product datasheet" %}: <a href="{% url 'datasheet_by_slug' device_type.slug %}" target="_blank" rel="noopener">{% trans "View" %}</a> · <a href="{% url 'admin_app:admin_product_datasheet_edit' first_datasheet.pk %}">{% trans "Edit" %}</a>{% if first_datasheet.file %} · <a href="{{ first_datasheet.file.url }}" target="_blank" rel="noopener">{% trans "Download PDF" %}</a>{% endif %}</p>
{% endif %}
{% endwith %}

<h2 class="admin-page-subtitle">{% trans "Instances" %} ({{ instances|length }})</h2>

<div class="admin-table-wrap">
  <table class="admin-table">
    <thead>
      <tr>
        <th>{% trans "Name" %}</th>
        <th>{% trans "Serial number" %}</th>
        <th>{% trans "IP address" %}</th>
        <th>{% trans "Facility" %}</th>
        <th>{% trans "Rack" %}</th>
        <th>{% trans "SLA" %}</th>
        <th class="admin-table-actions"></th>
      </tr>
    </thead>
    <tbody>
      {% for inst in instances %}
      <tr>
        <td><strong>{{ inst.name }}</strong></td>
        <td>{{ inst.serial_number|default:"—" }}</td>
        <td><code>{{ inst.ip_address|default:"—" }}</code></td>
        <td>{% if inst.facility %}<a href="{% url 'admin_app:admin_facility_detail' inst.facility.slug %}">{{ inst.facility.name }}</a>{% else %}—{% endif %}</td>
        <td>{% if inst.rack and inst.facility %}<a href="{% url 'admin_app:admin_rack_detail' inst.facility.slug inst.rack.pk %}">{{ inst.rack.name }}</a>{% if inst.rack_position %} (U{{ inst.rack_position }}){% endif %}{% else %}—{% endif %}</td>
        <td>{% if inst.is_sla %}<span title="{% trans 'Part of service agreement (FDV)' %}">✓</span>{% else %}—{% endif %}</td>
        <td class="admin-table-actions">
          <a href="{% url 'admin_app:admin_device_instance_edit' device_type.slug inst.pk %}" class="admin-btn-sm">{% trans "Edit" %}</a>
          <form method="post" action="{% url 'admin_app:admin_device_instance_delete' device_type.slug inst.pk %}" style="display:inline;" onsubmit="return confirm('{% trans "Remove this instance?" %}');">
            {% csrf_token %}
            <button type="submit" class="admin-btn-sm admin-btn-danger">{% trans "Remove" %}</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7">{% trans "No instances yet. Add an instance to register physical units of this type." %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
