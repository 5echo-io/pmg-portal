{% extends "portal/base.html" %}
{% load static i18n %}

{% block title %}{% block admin_title %}{% trans "Admin" %}{% endblock %} | {% trans "PMG Portal" %}{% endblock %}

{% block content %}
{% block admin_breadcrumb %}
<div class="breadcrumb-row">
  {% block breadcrumb_back %}
  <a href="{% url 'admin_app:admin_home' %}" class="breadcrumb-back-btn" aria-label="{% trans 'Back to Admin' %}">‚Üê {% trans "Admin" %}</a>
  {% endblock %}
  <nav class="breadcrumb admin-breadcrumb" aria-label="Breadcrumb">
    <a href="{% url 'admin_app:admin_home' %}">{% trans "Admin" %}</a>
    {% block breadcrumb_extra %}{% endblock %}
  </nav>
</div>
{% endblock %}
{% if messages %}
<ul class="admin-messages">
  {% for message in messages %}
  <li class="admin-message admin-message-{{ message.tags }}">{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
{% block admin_content %}{% endblock %}

<!-- Delete Confirmation Modal -->
<div id="delete-confirm-modal" class="modal" style="display: none;" onclick="closeDeleteConfirmModal(event)">
  <div class="modal-content modal-content-danger" onclick="event.stopPropagation()">
    <div class="modal-header modal-header-danger">
      <h2>{% trans "Confirm Deletion" %}</h2>
      <button class="modal-close" onclick="closeDeleteConfirmModal(event)">&times;</button>
    </div>
    <div class="modal-body">
      <div class="danger-zone">
        <div class="danger-zone-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"></path>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
          </svg>
        </div>
        <h3>{% trans "Warning: This action cannot be undone" %}</h3>
        <p class="delete-confirm-modal-message"></p>
        <p><strong>{% trans "This action is irreversible." %}</strong></p>
        <form method="post" action="" class="delete-confirm-form" style="margin-top: 24px;">
          {% csrf_token %}
          <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
            <button type="button" class="form-btn form-btn-secondary delete-confirm-cancel">{% trans "Cancel" %}</button>
            <button type="submit" class="form-btn form-btn-danger delete-confirm-submit" disabled data-delete-label="{% trans 'Delete' %}">
              <span class="delete-confirm-countdown"></span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  const modal = document.getElementById('delete-confirm-modal');
  const closeBtn = modal.querySelector('.modal-close');
  const cancelBtn = modal.querySelector('.delete-confirm-cancel');
  const submitBtn = modal.querySelector('.delete-confirm-submit');
  const form = modal.querySelector('.delete-confirm-form');
  const messageEl = modal.querySelector('.delete-confirm-modal-message');
  const countdownEl = submitBtn.querySelector('.delete-confirm-countdown');
  
  let countdownInterval = null;
  let countdownSeconds = 3;
  
  function openDeleteModal(url, message) {
    messageEl.textContent = message;
    form.action = url;
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // Reset countdown
    countdownSeconds = 3;
    submitBtn.disabled = true;
    updateCountdown();
    
    // Start countdown
    countdownInterval = setInterval(function() {
      countdownSeconds--;
      updateCountdown();
      
      if (countdownSeconds <= 0) {
        clearInterval(countdownInterval);
        submitBtn.disabled = false;
        countdownEl.textContent = submitBtn.dataset.deleteLabel || 'Delete';
      }
    }, 1000);
  }
  
  function updateCountdown() {
    if (countdownSeconds > 0) {
      var deleteLabel = submitBtn.dataset.deleteLabel || 'Delete';
    countdownEl.textContent = deleteLabel + ' (' + countdownSeconds + 's)';
    }
  }
  
  function closeDeleteConfirmModal(e) {
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }
    modal.style.display = 'none';
    document.body.style.overflow = '';
    if (countdownInterval) {
      clearInterval(countdownInterval);
      countdownInterval = null;
    }
    countdownSeconds = 3;
    submitBtn.disabled = true;
    countdownEl.textContent = '';
  }
  
  // Close handlers
  if (closeBtn) closeBtn.addEventListener('click', closeDeleteConfirmModal);
  if (cancelBtn) cancelBtn.addEventListener('click', closeDeleteConfirmModal);
  
  // Handle delete button clicks
  document.addEventListener('click', function(e) {
    const deleteBtn = e.target.closest('[data-delete-url]');
    if (deleteBtn) {
      e.preventDefault();
      const url = deleteBtn.getAttribute('data-delete-url');
      const message = deleteBtn.getAttribute('data-delete-message') || 'Are you sure you want to delete this item?';
      openDeleteModal(url, message);
    }
  });
  
  // Make function globally available
  window.closeDeleteConfirmModal = closeDeleteConfirmModal;
})();
</script>
{% endblock %}
