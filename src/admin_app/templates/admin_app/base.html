{% extends "portal/base.html" %}
{% load static %}

{% block title %}{% block admin_title %}Admin{% endblock %} | PMG Portal{% endblock %}

{% block content %}
{% block admin_breadcrumb %}
<nav class="breadcrumb admin-breadcrumb" aria-label="Breadcrumb">
  <a href="{% url 'admin_app:admin_home' %}">Admin</a>
  {% block breadcrumb_extra %}{% endblock %}
</nav>
{% endblock %}
{% if messages %}
<ul class="admin-messages">
  {% for message in messages %}
  <li class="admin-message admin-message-{{ message.tags }}">{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
{% block admin_content %}{% endblock %}

<!-- Delete Confirmation Modal -->
<div id="delete-confirm-modal" class="delete-confirm-modal" style="display: none;">
  <div class="delete-confirm-modal-overlay"></div>
  <div class="delete-confirm-modal-content">
    <div class="delete-confirm-modal-header">
      <h2 class="delete-confirm-modal-title">Confirm Deletion</h2>
      <button type="button" class="delete-confirm-modal-close" aria-label="Close">&times;</button>
    </div>
    <div class="delete-confirm-modal-body">
      <p class="delete-confirm-modal-message"></p>
      <p class="delete-confirm-modal-warning">This action cannot be undone.</p>
    </div>
    <div class="delete-confirm-modal-footer">
      <form method="post" action="" class="delete-confirm-form">
        {% csrf_token %}
        <button type="button" class="form-btn form-btn-secondary delete-confirm-cancel">Cancel</button>
        <button type="submit" class="form-btn form-btn-danger delete-confirm-submit" disabled>
          <span class="delete-confirm-countdown"></span>
        </button>
      </form>
    </div>
  </div>
</div>

<script>
(function() {
  const modal = document.getElementById('delete-confirm-modal');
  const overlay = modal.querySelector('.delete-confirm-modal-overlay');
  const closeBtn = modal.querySelector('.delete-confirm-modal-close');
  const cancelBtn = modal.querySelector('.delete-confirm-cancel');
  const submitBtn = modal.querySelector('.delete-confirm-submit');
  const form = modal.querySelector('.delete-confirm-form');
  const messageEl = modal.querySelector('.delete-confirm-modal-message');
  const countdownEl = submitBtn.querySelector('.delete-confirm-countdown');
  
  let countdownInterval = null;
  let countdownSeconds = 3;
  
  function openDeleteModal(url, message) {
    messageEl.textContent = message;
    form.action = url;
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';
    
    // Reset countdown
    countdownSeconds = 3;
    submitBtn.disabled = true;
    updateCountdown();
    
    // Start countdown
    countdownInterval = setInterval(function() {
      countdownSeconds--;
      updateCountdown();
      
      if (countdownSeconds <= 0) {
        clearInterval(countdownInterval);
        submitBtn.disabled = false;
        countdownEl.textContent = 'Delete';
      }
    }, 1000);
  }
  
  function updateCountdown() {
    if (countdownSeconds > 0) {
      countdownEl.textContent = 'Delete (' + countdownSeconds + 's)';
    }
  }
  
  function closeDeleteModal() {
    modal.style.display = 'none';
    document.body.style.overflow = '';
    if (countdownInterval) {
      clearInterval(countdownInterval);
      countdownInterval = null;
    }
    countdownSeconds = 3;
    submitBtn.disabled = true;
    countdownEl.textContent = '';
  }
  
  // Close handlers
  if (overlay) overlay.addEventListener('click', closeDeleteModal);
  if (closeBtn) closeBtn.addEventListener('click', closeDeleteModal);
  if (cancelBtn) cancelBtn.addEventListener('click', closeDeleteModal);
  
  // Handle delete button clicks
  document.addEventListener('click', function(e) {
    const deleteBtn = e.target.closest('[data-delete-url]');
    if (deleteBtn) {
      e.preventDefault();
      const url = deleteBtn.getAttribute('data-delete-url');
      const message = deleteBtn.getAttribute('data-delete-message') || 'Are you sure you want to delete this item?';
      openDeleteModal(url, message);
    }
  });
})();
</script>
{% endblock %}
