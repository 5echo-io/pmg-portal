{% extends "portal/base.html" %}
{% load i18n %}
{% block title %}{% trans "Product datasheets" %} | {% trans "PMG Portal" %}{% endblock %}

{% block content %}
<div class="datasheet-list-page">
  <div class="breadcrumb-row">
    <a href="/" class="breadcrumb-back-btn" aria-label="{% trans 'Back to Dashboard' %}" hx-get="/" hx-target="#main-content" hx-push-url="true">← {% trans "Dashboard" %}</a>
    <nav class="breadcrumb admin-breadcrumb" aria-label="Breadcrumb">
      <a href="/" hx-get="/" hx-target="#main-content" hx-push-url="true">{% trans "Dashboard" %}</a>
      <span class="breadcrumb-sep">→</span>
      <span>{% trans "Product datasheets" %}</span>
    </nav>
  </div>

  <h1 class="datasheet-list-page-title">{% trans "Product datasheets" %}</h1>
  <p class="datasheet-list-page-desc">{% trans "Choose a product to view or download its datasheet." %}</p>

  {% if datasheet_items %}
  <div class="datasheet-list-toolbar">
    <div class="datasheet-search-wrap">
      <input type="search" id="datasheet-search" class="datasheet-search-input" placeholder="{% trans 'Search by product name…' %}" autocomplete="off" aria-label="{% trans 'Search datasheets' %}">
    </div>
    <span class="datasheet-list-count" id="datasheet-list-count" aria-live="polite"></span>
  </div>

  <ul class="datasheet-list-cards" id="datasheet-list-cards">
    {% for item in datasheet_items %}
    <li class="datasheet-card" data-name="{{ item.device_type.name }}">
      <div class="datasheet-card-inner">
        <h2 class="datasheet-card-title">{{ item.device_type.name }}</h2>
        {% if item.datasheet %}
        <p class="datasheet-card-meta">
          {% trans "Created" %}: {{ item.datasheet.uploaded_at|date:"Y-m-d" }}{% if item.datasheet.updated_at %} · {% trans "Updated" %}: {{ item.datasheet.updated_at|date:"Y-m-d" }}{% endif %}
        </p>
        {% endif %}
        <div class="datasheet-card-actions">
          <a href="{% url 'datasheet_by_slug' item.device_type.slug %}" class="datasheet-card-btn datasheet-card-btn-primary" hx-get="{% url 'datasheet_by_slug' item.device_type.slug %}" hx-target="#main-content" hx-push-url="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            {% trans "View datasheet" %}
          </a>
          <a href="{% url 'datasheet_pdf' item.device_type.slug %}" class="datasheet-card-btn datasheet-card-btn-secondary" target="_blank" rel="noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="M9 15l3 3 3-3"/></svg>
            {% trans "Download PDF" %}
          </a>
        </div>
      </div>
    </li>
    {% endfor %}
  </ul>

  <p class="datasheet-list-empty muted" id="datasheet-list-empty" hidden>{% trans "No datasheets match your search." %}</p>
  {% else %}
  <p class="muted">{% trans "No product datasheets available yet." %}</p>
  {% endif %}
</div>
<style>
.datasheet-list-page { width: 100%; max-width: 1200px; }
.datasheet-list-page-title { margin: 0 0 0.5rem 0; font-size: 1.5rem; }
.datasheet-list-page-desc { color: var(--muted); font-size: 0.9375rem; margin: 0 0 1.25rem 0; }
.datasheet-list-toolbar {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 12px;
  margin-bottom: 1.25rem;
}
.datasheet-search-wrap {
  flex: 1;
  min-width: 200px;
  max-width: 360px;
  position: relative;
}
.datasheet-search-input {
  width: 100%;
  padding: 8px 12px 8px 36px;
  font-size: 0.875rem;
  border: 1px solid var(--line);
  border-radius: 8px;
  background: var(--card);
  color: var(--text);
  transition: border-color 0.2s, box-shadow 0.2s;
}
.datasheet-search-input::placeholder { color: var(--muted); }
.datasheet-search-input:focus {
  outline: none;
  border-color: var(--muted);
  box-shadow: 0 0 0 2px rgba(0,0,0,0.06);
}
.datasheet-search-wrap::before {
  content: '';
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E") no-repeat center;
  pointer-events: none;
}
.datasheet-list-count { font-size: 0.8125rem; color: var(--muted); }
.datasheet-list-cards {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 12px;
}
.datasheet-card {
  margin: 0;
  border: 1px solid var(--line);
  border-radius: 10px;
  background: var(--card);
  overflow: hidden;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.datasheet-card:hover { border-color: var(--muted); box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.datasheet-card.hidden { display: none; }
.datasheet-card-inner { padding: 14px 18px; }
.datasheet-card-title { margin: 0 0 6px 0; font-size: 1rem; font-weight: 600; }
.datasheet-card-meta { margin: 0 0 10px 0; font-size: 0.75rem; color: var(--muted); line-height: 1.4; }
.datasheet-card-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.datasheet-card-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  font-size: 0.875rem;
  border-radius: 8px;
  text-decoration: none;
  transition: background 0.2s, color 0.2s, border-color 0.2s;
  border: 1px solid transparent;
}
.datasheet-card-btn svg { flex-shrink: 0; stroke: currentColor; }
.datasheet-card-btn-primary {
  background: var(--btn);
  color: var(--text);
  border-color: var(--line);
}
.datasheet-card-btn-primary:hover { background: var(--btnHover); }
.datasheet-card-btn-secondary {
  background: transparent;
  color: var(--muted);
  border-color: var(--line);
}
.datasheet-card-btn-secondary:hover { color: var(--text); border-color: var(--muted); }
.datasheet-list-empty { margin-top: 1rem; }
</style>
<script>
(function() {
  var searchEl = document.getElementById('datasheet-search');
  var cardsEl = document.getElementById('datasheet-list-cards');
  var countEl = document.getElementById('datasheet-list-count');
  var emptyEl = document.getElementById('datasheet-list-empty');
  if (!searchEl || !cardsEl) return;
  function normalize(s) { return (s || '').toLowerCase().trim(); }
  function updateFilter() {
    var q = normalize(searchEl.value);
    var cards = cardsEl.querySelectorAll('.datasheet-card');
    var visible = 0;
    cards.forEach(function(card) {
      var name = normalize(card.getAttribute('data-name') || '');
      var show = !q || name.indexOf(q) !== -1;
      card.classList.toggle('hidden', !show);
      if (show) visible++;
    });
    if (countEl) countEl.textContent = visible === cards.length ? '' : visible + ' / ' + cards.length;
    if (emptyEl) {
      emptyEl.hidden = visible > 0;
    }
  }
  searchEl.addEventListener('input', updateFilter);
  searchEl.addEventListener('change', updateFilter);
  updateFilter();
})();
</script>
{% endblock %}
