{% extends "portal/base.html" %}
{% load i18n static %}
{% block title %}{% trans "Select Customer" %} | {% trans "PMG Portal" %}{% endblock %}

{% block content %}
  <div class="customer-selection-container">
    <div class="customer-selection-header">
      <h1>{% trans "Select Customer Profile" %}</h1>
    </div>

    {% if customers|length > 4 %}
    <div class="customer-selection-search">
      <input type="text" class="customer-selection-search-input" id="customer-selection-search" placeholder="{% trans 'Search customersâ€¦' %}" oninput="filterCustomerSelection(this.value)" aria-label="{% trans 'Search customers' %}">
    </div>
    {% endif %}

    <div class="customer-selection-list">
      {% for customer in customers %}
      <div class="customer-selection-item" data-customer-id="{{ customer.id }}" data-customer-name="{{ customer.name|escape }}" data-customer-select="true">
        {% if customer.logo_url %}
        <div class="customer-selection-item-logo">
          <img src="{{ customer.logo_url }}" alt="{{ customer.name }} logo" onerror="this.style.display='none';" />
        </div>
        {% else %}
        <div class="customer-selection-item-logo customer-selection-item-logo--placeholder">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <path d="M21 15l-5-5L5 21"></path>
          </svg>
        </div>
        {% endif %}
        <div class="customer-selection-item-content">
          <div class="customer-selection-item-name">{{ customer.name }}</div>
          {% if customer.org_number %}
          <div class="customer-selection-item-org muted">{% trans "Org. no." %}: {{ customer.org_number }}</div>
          {% endif %}
        </div>
        <div class="customer-selection-item-arrow">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <form method="post" action="" id="customer-switcher-form" style="display: none;">
    {% csrf_token %}
  </form>

  <script>
    // Handle customer selection card clicks
    document.addEventListener('click', function(e) {
      const card = e.target.closest('[data-customer-select="true"]');
      if (card) {
        const customerId = card.getAttribute('data-customer-id');
        if (customerId) {
          selectCustomer(customerId);
        }
      }
    });

    // Filter customer selection list
    function filterCustomerSelection(q) {
      q = (q || '').toLowerCase().trim();
      document.querySelectorAll('.customer-selection-item').forEach(function(item) {
        const name = (item.getAttribute('data-customer-name') || item.textContent || '').toLowerCase();
        item.style.display = q === '' || name.indexOf(q) !== -1 ? '' : 'none';
      });
    }
  </script>
{% endblock %}
