{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% block title %}PMG Portal{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'app.css' %}">
</head>
<body>
  <header class="topbar">
    <div class="brand">PMG Portal</div>
    <div class="topbar-right">
      <span class="muted">{{ request.user.username }}</span>
      <a class="link" href="/portal/">Portal</a>
      <a class="link" href="/admin/">Admin</a>
      <a class="link" href="/account/logout/">Logout</a>
    </div>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <div class="footer-title">PMG Portal</div>
        <div class="footer-text">Version {{ app_version|default:"Unknown" }}</div>
        <div class="footer-text muted">Copyright &copy; {{ copyright_year|default:"2026" }} 5echo.io</div>
      </div>
      <div class="footer-section">
        <div class="footer-title">Quick Links</div>
        <a href="/admin/" class="footer-link">Admin Panel</a>
        <a href="/portal/" class="footer-link">Portal</a>
        <a href="/account/logout/" class="footer-link">Logout</a>
      </div>
      <div class="footer-section">
        <div class="footer-title">System</div>
        <a href="/admin/" class="footer-link">View Logs</a>
        <div class="footer-text muted">View system logs in admin panel</div>
      </div>
      {% if changelog_preview %}
      <div class="footer-section">
        <div class="footer-title">Latest Changes</div>
        <div class="footer-changelog">{{ changelog_preview|linebreaks|truncatewords:30 }}</div>
        {% if changelog_full %}
        <button class="footer-btn" onclick="openChangelogModal()">View Full Changelog</button>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </footer>

  <!-- Changelog Modal -->
  {% if changelog_full %}
  <div id="changelogModal" class="modal" onclick="closeChangelogModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>Changelog</h2>
        <button class="modal-close" onclick="closeChangelogModal(event)">&times;</button>
      </div>
      <div class="modal-body">
        <pre class="changelog-content">{{ changelog_full|escape }}</pre>
      </div>
    </div>
  </div>
  {% endif %}

  <script>
    function openChangelogModal() {
      document.getElementById('changelogModal').style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
    
    function closeChangelogModal(event) {
      if (!event || event.target.classList.contains('modal') || event.target.classList.contains('modal-close')) {
        document.getElementById('changelogModal').style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    }
    
    // Close on ESC key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('changelogModal');
        if (modal && modal.style.display === 'flex') {
          closeChangelogModal(event);
        }
      }
    });
  </script>
</body>
</html>
