{% load i18n static %}
<div class="facility-detail-container">
  <div class="breadcrumb-row">
    <a href="{% url 'facility_detail' facility.slug %}#servicelogg" class="breadcrumb-back-btn" aria-label="{% trans 'Back to facility' %}" hx-get="{% url 'facility_detail' facility.slug %}" hx-target="#main-content" hx-push-url="{% url 'facility_detail' facility.slug %}#servicelogg">← {{ facility.name }}</a>
    <nav class="breadcrumb admin-breadcrumb" aria-label="Breadcrumb">
      <a href="{% url 'facility_list' %}" hx-get="{% url 'facility_list' %}" hx-target="#main-content" hx-push-url="true">{% trans "Facilities" %}</a>
      <span class="breadcrumb-sep">→</span>
      <a href="{% url 'facility_detail' facility.slug %}#servicelogg" hx-get="{% url 'facility_detail' facility.slug %}" hx-target="#main-content" hx-push-url="{% url 'facility_detail' facility.slug %}#servicelogg">{{ facility.name }}</a>
      <span class="breadcrumb-sep">→</span>
      <span>{% trans "Servicerapport" %}: {{ service_log.service_id }}</span>
    </nav>
  </div>

  <div class="customer-card-container">
    <div class="customer-card-header" style="padding-bottom: 16px;">
      <div class="customer-card-info" style="flex: 1;">
        <h1 class="customer-card-name" style="margin: 0 0 8px 0;">{% trans "Servicerapport" %}</h1>
        <p class="customer-card-slug" style="margin: 0;">{{ facility.name }} — {{ service_log.service_id }}</p>
      </div>
      <div class="customer-card-header-actions">
        <a href="{% url 'facility_service_log_pdf' facility.slug service_log.pk %}" target="_blank" rel="noopener" class="customer-card-icon-btn" title="{% trans 'Print report' %}" aria-label="{% trans 'Print report' %}">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/></svg>
        </a>
      </div>
    </div>

    <div class="panel" style="margin-top: 24px;">
      <dl class="service-log-dl">
        <dt>{% trans "Service ID" %}</dt>
        <dd><strong>{{ service_log.service_id }}</strong>{% if service_log.external_id %} <span class="muted">({{ service_log.external_id }})</span>{% endif %}</dd>

        {% if service_log.service_type %}
        <dt>{% trans "Type" %}</dt>
        <dd>{{ service_log.service_type.name }}</dd>
        {% endif %}

        <dt>{% trans "Performed at" %}</dt>
        <dd>{{ service_log.performed_at|date:"d.m.Y H:i" }}</dd>

        <dt>{% trans "Technician" %}</dt>
        <dd>{{ service_log.technician_employee_no|default:"—" }}</dd>

        {% if service_log.asset_name or service_log.asset_id %}
        <dt>{% trans "Asset" %}</dt>
        <dd>{{ service_log.asset_name|default:"" }}{% if service_log.asset_id %} ({{ service_log.asset_id }}){% endif %}</dd>
        {% endif %}
        {% if service_log.customer_name %}
        <dt>{% trans "Customer" %}</dt>
        <dd>{{ service_log.customer_name }}{% if service_log.contract_number %} — {% trans "Avtalenummer" %}: {{ service_log.contract_number }}{% endif %}</dd>
        {% endif %}
        {% if service_log.background %}
        <dt>{% trans "Bakgrunn" %}</dt>
        <dd><div style="white-space: pre-wrap;">{{ service_log.background }}</div></dd>
        {% endif %}
        {% if service_log.summary %}
        <dt>{% trans "Oppsummering" %}</dt>
        <dd><div style="white-space: pre-wrap;">{{ service_log.summary }}</div></dd>
        {% endif %}
        <dt>{% trans "Rapport" %}</dt>
        <dd>{% if service_log.description %}<div style="white-space: pre-wrap;">{{ service_log.description }}</div>{% else %}—{% endif %}</dd>
        {% if service_log.findings_observations %}
        <dt>{% trans "Funn og observasjoner" %}</dt>
        <dd><div style="white-space: pre-wrap;">{{ service_log.findings_observations }}</div></dd>
        {% endif %}
        {% if service_log.conclusion %}
        <dt>{% trans "Konklusjon" %}</dt>
        <dd><div style="white-space: pre-wrap;">{{ service_log.conclusion }}</div></dd>
        {% endif %}
        {% if service_log.recommendations_immediate or service_log.recommendations_long_term %}
        <dt>{% trans "Anbefalinger" %}</dt>
        <dd>{% if service_log.recommendations_immediate %}<p><strong>{% trans "Umiddelbare tiltak" %}</strong></p><div style="white-space: pre-wrap;">{{ service_log.recommendations_immediate }}</div>{% endif %}{% if service_log.recommendations_long_term %}<p style="margin-top:8px;"><strong>{% trans "Langsiktige tiltak" %}</strong></p><div style="white-space: pre-wrap;">{{ service_log.recommendations_long_term }}</div>{% endif %}</dd>
        {% endif %}
        {% if service_log.serviced_devices.all %}
        <dt>{% trans "Enheter som ble servet" %}</dt>
        <dd><ul style="margin:0;padding-left:20px;">{% for sd in service_log.serviced_devices.all %}<li>{{ sd.device.name }}{% if sd.serviced_at %} ({{ sd.serviced_at|date:"d.m.Y H:i" }}){% endif %}{% if sd.notes %} — {{ sd.notes }}{% endif %}</li>{% endfor %}</ul></dd>
        {% endif %}
        {% if service_log.notes %}
        <dt>{% trans "Notes" %}</dt>
        <dd><div style="white-space: pre-wrap;">{{ service_log.notes }}</div></dd>
        {% endif %}

        {% if service_log.sla_deadline %}
        <dt>{% trans "SLA deadline" %}</dt>
        <dd>{{ service_log.sla_deadline|date:"d.m.Y H:i" }}{% if service_log.sla_met is not None %} — {% if service_log.sla_met %}{% trans "SLA met" %}{% else %}{% trans "SLA not met" %}{% endif %}{% endif %}</dd>
        {% endif %}

        {% if service_log.approved_at %}
        <dt>{% trans "Approved" %}</dt>
        <dd>{{ service_log.approved_at|date:"d.m.Y H:i" }}{% if service_log.approved_by %} {% trans "by" %} {{ service_log.approved_by.get_full_name|default:service_log.approved_by.username }}{% endif %}{% if service_log.signature_notes %} — {{ service_log.signature_notes }}{% endif %}</dd>
        {% endif %}

        {% if service_log.attachments.all %}
        <dt>{% trans "Attachments" %}</dt>
        <dd>
          <ul class="service-log-attachments" style="margin: 0; padding-left: 20px;">
            {% for att in service_log.attachments.all %}
            <li><a href="{{ att.file.url }}" target="_blank" rel="noopener">{{ att.title|default:att.file.name }}</a></li>
            {% endfor %}
          </ul>
        </dd>
        {% endif %}

        <dt>{% trans "Created" %}</dt>
        <dd>{{ service_log.created_at|date:"d.m.Y H:i" }}{% if service_log.created_by %} {% trans "by" %} {{ service_log.created_by.get_full_name|default:service_log.created_by.username }}{% endif %}</dd>
      </dl>
    </div>
  </div>
</div>

<style>
.service-log-dl { display: grid; grid-template-columns: 180px 1fr; gap: 12px 24px; margin: 0; }
.service-log-dl dt { font-weight: 600; color: var(--muted, #6b7280); }
.service-log-dl dd { margin: 0; }
@media (max-width: 640px) { .service-log-dl { grid-template-columns: 1fr; } }
</style>
