{% load i18n %}
{% if messages %}
<div class="toast-container">
  {% for message in messages %}
  <div class="toast toast-{{ message.tags }}" data-toast-id="{{ forloop.counter }}">
    <div class="toast-content">
      <span class="toast-message">{{ message }}</span>
      <button class="toast-close" onclick="dismissToast(this.parentElement.parentElement)">×</button>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<div class="systemmeldinger-panel panel">
  <h2 class="systemmeldinger-panel-title">
    <span class="systemmeldinger-panel-icon" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
    </span>
    {% trans "Systemmeldinger" %}
  </h2>
  {% if announcements %}
  <ul class="announcement-list">
    {% for ann in announcements %}
    <li class="announcement-item {% if ann.is_pinned %}announcement-item--pinned{% endif %}">
      <span class="announcement-item-icon" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
      </span>
      <div class="announcement-item-content">
        <div class="announcement-title">{{ ann.title }}</div>
        <div class="announcement-meta muted">
          {% if ann.created_by %}{{ ann.created_by.get_full_name|default:ann.created_by.username }}{% endif %}
          · {{ ann.created_at|date:"SHORT_DATE_FORMAT" }}
          {% if ann.is_pinned %}<span class="announcement-pin-badge">{% trans "Pinned" %}</span>{% endif %}
        </div>
        <div class="announcement-body">{{ ann.body|safe|linebreaks }}</div>
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="muted">{% trans "Ingen systemmeldinger." %}</p>
  {% endif %}
</div>

<div class="customer-header">
  {% if customer.logo_url %}
  <img src="{{ customer.logo_url }}" alt="{{ customer.name }} logo" class="customer-logo {% if customer.logo_url_dark %}logo-light{% endif %}" onerror="this.style.display='none';" />
  {% endif %}
  {% if customer.logo_url_dark %}
  <img src="{{ customer.logo_url_dark }}" alt="{{ customer.name }} logo" class="customer-logo logo-dark" onerror="this.style.display='none';" />
  {% endif %}
  <div class="customer-header-text">
    <h1 class="customer-title">{{ customer.name }}</h1>
    <p class="muted">{% trans "This is your customer portal. Content will expand over time." %}</p>
  </div>
</div>

<div class="dashboard-widgets" data-widgets="{{ dashboard_widgets|join:',' }}">
  {% if "quick_stats" in dashboard_widgets and quick_stats %}
  <div class="dashboard-widget dashboard-widget-stats panel">
    <h2>{% trans "Quick stats" %}</h2>
    <div class="quick-stats-grid">
      <a href="{% url 'facility_list' %}" class="quick-stat-card">
        <span class="quick-stat-value">{{ quick_stats.facilities }}</span>
        <span class="quick-stat-label">{% trans "Facilities" %}</span>
      </a>
      <div class="quick-stat-card">
        <span class="quick-stat-value">{{ quick_stats.devices }}</span>
        <span class="quick-stat-label">{% trans "Devices" %}</span>
      </div>
      <div class="quick-stat-card">
        <span class="quick-stat-value">{{ quick_stats.links }}</span>
        <span class="quick-stat-label">{% trans "Links" %}</span>
      </div>
    </div>
  </div>
  {% endif %}

  {% if "recent_links" in dashboard_widgets and links %}
  <div class="dashboard-widget dashboard-widget-recent panel">
    <h2>{% trans "Recent links" %}</h2>
    <ul class="list">
      {% for item in links|slice:":5" %}
      <li class="list-item">
        <div class="list-title"><a href="{{ item.url }}" target="_blank" rel="noreferrer">{{ item.title }}</a></div>
        {% if item.description %}<div class="muted">{{ item.description }}</div>{% endif %}
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  {% if "quick_links" in dashboard_widgets %}
  <div class="dashboard-widget dashboard-widget-links panel">
    <h2>{% trans "Quick links" %}</h2>
    {% if links %}
    <ul class="list">
      {% for item in links %}
      <li class="list-item">
        <div class="list-title"><a href="{{ item.url }}" target="_blank" rel="noreferrer">{{ item.title }}</a></div>
        {% if item.description %}<div class="muted">{{ item.description }}</div>{% endif %}
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="muted">{% trans "No links yet. An admin can add links for this customer in the admin panel." %}</p>
    {% endif %}
  </div>
  {% endif %}
</div>
