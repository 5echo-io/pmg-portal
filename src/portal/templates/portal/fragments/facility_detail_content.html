{% load i18n static %}
<div class="facility-detail-container">
  <div class="breadcrumb-row">
    <a href="{% url 'facility_list' %}" class="breadcrumb-back-btn" aria-label="{% trans 'Back to Facilities' %}" hx-get="{% url 'facility_list' %}" hx-target="#main-content" hx-push-url="true">← {% trans "Facilities" %}</a>
    <nav class="breadcrumb admin-breadcrumb" aria-label="Breadcrumb">
      <a href="{% url 'facility_list' %}" hx-get="{% url 'facility_list' %}" hx-target="#main-content" hx-push-url="true">{% trans "Facilities" %}</a>
      <span class="breadcrumb-sep">→</span>
      <span>{{ facility.name }}</span>
    </nav>
  </div>

  <div class="customer-card-container">
    <div class="customer-card-header">
      <div class="customer-card-logo-section">
        <div class="customer-logo-upload-area" style="cursor: default;">
          <div class="customer-logo-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span>{% trans "Facility" %}</span>
          </div>
        </div>
        <div class="facility-side-status">
          <div class="facility-serviceavtale-badge facility-serviceavtale-badge--{% if has_serviceavtale %}yes{% else %}no{% endif %}" aria-label="{% if has_serviceavtale %}{% trans 'Service agreement active' %}{% else %}{% trans 'No service agreement' %}{% endif %}">
            <span class="facility-serviceavtale-dot" aria-hidden="true"></span>
            <span class="facility-serviceavtale-label">{% if has_serviceavtale %}{% trans "Serviceavtale" %}{% else %}{% trans "Ingen serviceavtale" %}{% endif %}</span>
          </div>
          {% if technical_support %}
          <div class="facility-technical-support">
            <h3 class="facility-technical-support-title">{% trans "Teknisk support" %}</h3>
            {% if technical_support.name %}<p class="facility-technical-support-name">{{ technical_support.name }}{% if technical_support.role %} <span class="facility-technical-support-role">({{ technical_support.role }})</span>{% endif %}</p>{% endif %}
            <div class="facility-technical-support-links">
              {% if technical_support.email %}<a href="mailto:{{ technical_support.email }}" class="facility-technical-support-link">{% trans "E-post" %}</a>{% endif %}
              {% if technical_support.phone %}<a href="tel:{{ technical_support.phone }}" class="facility-technical-support-link">{% trans "Telefon" %}</a>{% endif %}
            </div>
            {% if technical_support.support_info %}<p class="facility-technical-support-info">{{ technical_support.support_info|linebreaksbr }}</p>{% endif %}
          </div>
          {% endif %}
        </div>
      </div>
      <div class="customer-card-info">
        <div class="customer-card-name-wrapper">
          <div class="customer-card-title-block">
            <h1 class="customer-card-name">{{ facility.name }}</h1>
            <span class="customer-card-slug">{{ facility.slug }}</span>
          </div>
          <div class="customer-card-header-actions customer-card-header-actions--align">
            <span class="customer-card-badge customer-card-badge--{% if facility.is_active %}active{% else %}inactive{% endif %}">{% if facility.is_active %}{% trans "Active" %}{% else %}{% trans "Inactive" %}{% endif %}</span>
          </div>
        </div>
        {% if facility.city or facility.address %}
        <p class="customer-card-org">{% if facility.city %}{{ facility.city }}{% if facility.country %}, {{ facility.country }}{% endif %}{% endif %}</p>
        {% if facility.address %}<p class="customer-card-contact">{{ facility.address }}</p>{% endif %}
        {% endif %}
      </div>
    </div>

    <div class="facility-portal-overview">
      <h2 class="facility-portal-overview-title">{% trans "Oversikt" %}</h2>
      {% if facility.description %}
      <div class="facility-overview-description"><p>{{ facility.description }}</p></div>
      {% endif %}
      <div class="facility-overview-grid">
        <div class="facility-overview-item"><span class="facility-overview-num">{{ contacts|length }}</span><span class="facility-overview-label">{% trans "Kontaktpersoner" %}</span></div>
        <div class="facility-overview-item"><span class="facility-overview-num">{{ network_devices|length }}</span><span class="facility-overview-label">{% trans "Enheter" %}</span></div>
        <div class="facility-overview-item"><span class="facility-overview-num">{{ racks|length }}</span><span class="facility-overview-label">{% trans "Racks" %}</span></div>
        <div class="facility-overview-item"><span class="facility-overview-num">{{ ip_addresses|length }}</span><span class="facility-overview-label">{% trans "Nettverk" %}</span></div>
        <div class="facility-overview-item"><span class="facility-overview-num">{{ facility_datasheets|length }}</span><span class="facility-overview-label">{% trans "Product datasheets" %}</span></div>
        <div class="facility-overview-item"><span class="facility-overview-num">{{ service_logs|length }}</span><span class="facility-overview-label">{% trans "Servicelogg" %}</span></div>
        <div class="facility-overview-item"><span class="facility-overview-num">{{ documents|length }}</span><span class="facility-overview-label">{% trans "Dokumenter" %}</span></div>
      </div>
      {% if facility.important_info %}
      <div class="facility-important-info">
        <h3 class="facility-important-info-title">{% trans "Viktig informasjon" %}</h3>
        <div class="facility-important-info-body">{{ facility.important_info|linebreaks }}</div>
      </div>
      {% endif %}
    </div>

    <div class="facility-card-body">
      <nav class="facility-card-sidemenu" aria-label="{% trans 'Facility sections' %}">
        <a href="{% url 'facility_detail' facility.slug %}#contacts" class="facility-sidemenu-item active" data-tab="contacts">{% trans "Kontaktpersoner" %} ({{ contacts|length }})</a>
        <a href="{% url 'facility_detail' facility.slug %}#devices" class="facility-sidemenu-item" data-tab="devices">{% trans "Enheter" %} ({{ network_devices|length }})</a>
        <a href="{% url 'facility_detail' facility.slug %}#racks" class="facility-sidemenu-item" data-tab="racks">{% trans "Racks" %} ({{ racks|length }})</a>
        <a href="{% url 'facility_detail' facility.slug %}#network" class="facility-sidemenu-item" data-tab="network">{% trans "Nettverk" %} ({{ ip_addresses|length }})</a>
        <a href="{% url 'facility_detail' facility.slug %}#produktdatablader" class="facility-sidemenu-item" data-tab="produktdatablader">{% trans "Product datasheets" %} ({{ facility_datasheets|length }})</a>
        <a href="{% url 'facility_detail' facility.slug %}#servicelogg" class="facility-sidemenu-item" data-tab="servicelogg">{% trans "Servicelogg" %} ({{ service_logs|length }})</a>
        <a href="{% url 'facility_detail' facility.slug %}#documents" class="facility-sidemenu-item" data-tab="documents">{% trans "Dokumenter" %} ({{ documents|length }})</a>
      </nav>
      <div class="facility-card-content">
        <div class="customer-tab-panel active" id="tab-contacts">
          <div class="customer-section-header"><h2>{% trans "Kontaktpersoner" %}</h2></div>
          {% if contacts %}
          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead><tr><th>{% trans "Name" %}</th><th>{% trans "Role" %}</th><th>{% trans "Email" %}</th><th>{% trans "Phone" %}</th><th>{% trans "Primary" %}</th></tr></thead>
              <tbody>
                {% for c in contacts %}
                <tr>
                  <td><strong>{{ c.name }}</strong></td>
                  <td>{{ c.role|default:"—" }}</td>
                  <td>{% if c.email %}<a href="mailto:{{ c.email }}">{{ c.email }}</a>{% else %}—{% endif %}</td>
                  <td>{% if c.phone %}<a href="tel:{{ c.phone }}">{{ c.phone }}</a>{% else %}—{% endif %}</td>
                  <td>{% if c.is_primary %}{% trans "Yes" %}{% else %}—{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}<p class="muted">{% trans "No contact persons for this facility." %}</p>{% endif %}
        </div>
        <div class="customer-tab-panel" id="tab-devices">
          <div class="customer-section-header"><h2>{% trans "Enheter" %}</h2></div>
          {% if network_devices %}
          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead><tr><th>{% trans "Name" %}</th><th>{% trans "Type" %}</th><th>{% trans "Manufacturer" %}</th><th>{% trans "Model" %}</th><th>{% trans "SLA" %}</th><th></th></tr></thead>
              <tbody>
                {% for device in network_devices %}
                <tr>
                  <td><strong>{{ device.name }}</strong></td>
                  <td>{{ device.get_device_type_display }}</td>
                  <td>{{ device.manufacturer|default:"—" }}</td>
                  <td>{{ device.model|default:"—" }}</td>
                  <td>{% if device.is_sla %}✓{% else %}—{% endif %}</td>
                  <td><a href="{% url 'facility_device_detail' facility.slug device.pk %}" hx-get="{% url 'facility_device_detail' facility.slug device.pk %}" hx-target="#main-content" hx-push-url="true" class="admin-btn-sm">{% trans "Open" %}</a></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}<p class="muted">{% trans "No network devices configured for this facility." %}</p>{% endif %}
        </div>
        <div class="customer-tab-panel" id="tab-racks">
          <div class="customer-section-header"><h2>{% trans "Racks" %}</h2></div>
          {% if racks %}
          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead><tr><th>{% trans "Name" %}</th><th>{% trans "Location" %}</th><th>{% trans "Height" %}</th><th>{% trans "Status" %}</th></tr></thead>
              <tbody>
                {% for rack in racks %}
                <tr>
                  <td><strong>{{ rack.name }}</strong></td>
                  <td>{{ rack.location|default:"—" }}</td>
                  <td>{{ rack.height_units }}U</td>
                  <td>{% if rack.is_active %}<span class="role-badge role-badge--member">{% trans "Active" %}</span>{% else %}<span class="muted">{% trans "Inactive" %}</span>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}<p class="muted">{% trans "No racks configured for this facility." %}</p>{% endif %}
        </div>
        <div class="customer-tab-panel" id="tab-network">
          <div class="customer-section-header"><h2>{% trans "Nettverk" %} – {% trans "IP addresses" %}</h2></div>
          {% if ip_addresses %}
          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead><tr><th>{% trans "IP Address" %}</th><th>{% trans "Subnet" %}</th><th>{% trans "Reserved For" %}</th><th>{% trans "Device" %}</th><th>{% trans "Status" %}</th></tr></thead>
              <tbody>
                {% for ip in ip_addresses %}
                <tr>
                  <td><code>{{ ip.ip_address }}</code></td>
                  <td>{{ ip.subnet|default:"—" }}</td>
                  <td>{{ ip.reserved_for|default:"—" }}</td>
                  <td>{% if ip.device %}{{ ip.device.name }}{% else %}—{% endif %}</td>
                  <td>{% if ip.is_in_use %}<span class="role-badge role-badge--admin">{% trans "In Use" %}</span>{% else %}<span class="muted">{% trans "Available" %}</span>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}<p class="muted">{% trans "No IP addresses reserved for this facility." %}</p>{% endif %}

          <div class="network-doc-section" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--line, #e5e7eb);">
            <div class="customer-section-header">
              <h2>{% trans "Nettverksdokumentasjon" %}</h2>
              <a href="{% url 'facility_network_documentation_pdf' facility.slug %}" class="admin-btn-sm" target="_blank" rel="noopener">{% trans "Download PDF" %}</a>
            </div>
            <h3 style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600;">{% trans "Utstyrsoversikt" %}</h3>
            <p class="muted" style="margin: 0 0 12px 0; font-size: 0.8125rem;">{% trans "Kun nettverksenheter (switcher, rutere, brannmurer, tilgangspunkter m.m.)." %}</p>
            {% if network_devices %}
            <div class="admin-table-wrap">
              <table class="admin-table">
                <thead><tr><th>{% trans "Name" %}</th><th>{% trans "Type" %}</th><th>{% trans "Manufacturer" %}</th><th>{% trans "Model" %}</th><th>{% trans "Rack" %}</th><th>{% trans "IP Address" %}</th><th>{% trans "SLA" %}</th></tr></thead>
                <tbody>
                  {% for device in network_devices %}
                  <tr>
                    <td><strong>{{ device.name }}</strong></td>
                    <td>{{ device.get_device_type_display }}</td>
                    <td>{{ device.manufacturer|default:"—" }}</td>
                    <td>{{ device.model|default:"—" }}</td>
                    <td>{% if device.rack %}{{ device.rack.name }}{% if device.rack_position %} ({{ device.rack_position }}U){% endif %}{% else %}—{% endif %}</td>
                    <td>{% if device.ip_address %}<code>{{ device.ip_address }}</code>{% else %}—{% endif %}</td>
                    <td>{% if device.is_sla %}✓{% else %}—{% endif %}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}<p class="muted">{% trans "No network devices configured for this facility." %}</p>{% endif %}
          </div>
        </div>
        <div class="customer-tab-panel" id="tab-produktdatablader">
          <div class="customer-section-header"><h2>{% trans "Product datasheets" %}</h2></div>
          {% if facility_datasheets %}
          <div class="facility-datasheets-toolbar">
            <label for="facility-datasheets-search" class="facility-datasheets-search-label">{% trans "Search" %}</label>
            <input type="search" id="facility-datasheets-search" class="facility-datasheets-search-input" placeholder="{% trans 'Search by product name…' %}" autocomplete="off" aria-label="{% trans 'Search datasheets' %}">
            <span class="facility-datasheets-count" id="facility-datasheets-count" aria-live="polite"></span>
          </div>
          <ul class="facility-datasheets-list" id="facility-datasheets-list">
            {% for ds in facility_datasheets %}
            <li class="facility-datasheet-row" data-name="{{ ds.title }}">
              <span class="facility-datasheet-title">{{ ds.title }}</span>
              <span class="facility-datasheet-actions">
                <a href="{% url 'datasheet_by_slug' ds.device_type.slug %}" class="facility-datasheet-btn" target="_blank" rel="noopener">{% trans "View datasheet" %}</a>
                <a href="{% url 'datasheet_pdf' ds.device_type.slug %}" class="facility-datasheet-btn facility-datasheet-btn--secondary" target="_blank" rel="noopener">{% trans "Download PDF" %}</a>
              </span>
            </li>
            {% endfor %}
          </ul>
          <p class="facility-datasheets-empty muted" id="facility-datasheets-empty" hidden>{% trans "No datasheets match your search." %}</p>
          {% else %}
          <p class="muted">{% trans "No product datasheets for devices at this facility." %}</p>
          {% endif %}
        </div>
        <div class="customer-tab-panel" id="tab-servicelogg">
          <div class="customer-section-header servicelogg-header">
            <h2>{% trans "Servicelogg" %}</h2>
            {% if service_types %}
            <form method="get" action="" class="servicelogg-type-filter">
              <label for="filter-service-type" class="servicelogg-type-label">{% trans "Type" %}:</label>
              <select name="service_type" id="filter-service-type" class="servicelogg-type-select" onchange="this.form.submit()">
                <option value="">{% trans "All" %}</option>
                {% for st in service_types %}
                <option value="{{ st.slug }}" {% if service_type_filter == st.slug %}selected{% endif %}>{{ st.name }}</option>
                {% endfor %}
              </select>
            </form>
            {% endif %}
          </div>
          {% if service_logs %}
          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead><tr><th>{% trans "Date" %}</th><th>{% trans "Service ID" %}</th><th>{% trans "Type" %}</th><th>{% trans "Description" %}</th><th>{% trans "Technician" %}</th><th></th></tr></thead>
              <tbody>
                {% for log in service_logs %}
                <tr>
                  <td>{{ log.performed_at|date:"d.m.Y" }}</td>
                  <td><strong>{{ log.service_id }}</strong></td>
                  <td>{% if log.service_type %}{{ log.service_type.name }}{% else %}—{% endif %}</td>
                  <td>{{ log.description|truncatewords:15|default:"—" }}</td>
                  <td>{{ log.technician_employee_no|default:"—" }}</td>
                  <td><a href="{% url 'facility_service_log_detail' facility.slug log.pk %}" hx-get="{% url 'facility_service_log_detail' facility.slug log.pk %}" hx-target="#main-content" hx-push-url="true" class="admin-btn-sm">{% trans "Open" %}</a></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}<p class="muted">{% trans "No service log entries for this facility." %}</p>{% endif %}
        </div>
        <div class="customer-tab-panel" id="tab-documents">
          <div class="customer-section-header"><h2>{% trans "Dokumenter" %}</h2></div>
          {% if documents %}
          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead><tr><th>{% trans "Title" %}</th><th>{% trans "Category" %}</th><th>{% trans "Uploaded" %}</th><th>{% trans "Uploaded By" %}</th><th></th></tr></thead>
              <tbody>
                {% for doc in documents %}
                <tr>
                  <td>{{ doc.title }}</td>
                  <td>{{ doc.get_category_display }}</td>
                  <td>{{ doc.uploaded_at|date:"Y-m-d H:i" }}</td>
                  <td>{% if doc.uploaded_by %}{{ doc.uploaded_by.get_full_name|default:doc.uploaded_by.username }}{% else %}—{% endif %}</td>
                  <td><a href="{{ doc.file.url }}" target="_blank" class="admin-btn-sm">{% trans "Download" %}</a></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}<p class="muted">{% trans "No documents uploaded for this facility." %}</p>{% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.facility-portal-overview { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--line, #e5e7eb); }
.facility-portal-overview-title { margin: 0 0 12px 0; font-size: 0.9375rem; font-weight: 600; color: var(--muted, #6b7280); }
.facility-overview-description { margin-bottom: 12px; }
.facility-overview-description p { margin: 0; font-size: 0.875rem; line-height: 1.5; color: var(--text); white-space: pre-wrap; }
.facility-overview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
.facility-overview-item { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; padding: 10px 12px; background: var(--card, #fff); border: 1px solid var(--line, #e5e7eb); border-radius: 8px; }
.facility-overview-num { font-size: 1.25rem; font-weight: 600; color: var(--text); line-height: 1.2; }
.facility-overview-label { font-size: 0.75rem; color: var(--muted, #6b7280); }
.facility-side-status { margin-top: 16px; display: flex; flex-direction: column; gap: 12px; }
.facility-serviceavtale-badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 8px; font-size: 0.8125rem; font-weight: 600; width: fit-content; }
.facility-serviceavtale-badge--yes { background: rgba(34, 197, 94, 0.15); color: #15803d; border: 1px solid rgba(34, 197, 94, 0.4); }
.facility-serviceavtale-badge--no { background: rgba(239, 68, 68, 0.1); color: #b91c1c; border: 1px solid rgba(239, 68, 68, 0.35); }
.facility-serviceavtale-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.facility-serviceavtale-badge--yes .facility-serviceavtale-dot { background: #22c55e; }
.facility-serviceavtale-badge--no .facility-serviceavtale-dot { background: #ef4444; }
.facility-technical-support { padding: 12px 14px; background: var(--card, #fff); border: 1px solid var(--line, #e5e7eb); border-radius: 8px; }
.facility-technical-support-title { margin: 0 0 8px 0; font-size: 0.8125rem; font-weight: 600; color: var(--muted, #6b7280); text-transform: uppercase; letter-spacing: 0.02em; }
.facility-technical-support-name { margin: 0 0 6px 0; font-size: 0.875rem; font-weight: 500; color: var(--text, #111); }
.facility-technical-support-role { font-weight: 400; color: var(--muted); }
.facility-technical-support-links { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 6px; }
.facility-technical-support-link { font-size: 0.8125rem; color: #3b82f6; text-decoration: none; }
.facility-technical-support-link:hover { text-decoration: underline; }
.facility-technical-support-info { margin: 0; font-size: 0.75rem; color: var(--muted); line-height: 1.4; white-space: pre-wrap; }
.facility-important-info { margin-top: 16px; padding: 14px 16px; background: rgba(59, 130, 246, 0.08); border: 1px solid rgba(59, 130, 246, 0.25); border-radius: 8px; }
.facility-important-info-title { margin: 0 0 8px 0; font-size: 0.9375rem; font-weight: 600; color: var(--text, #111); }
.facility-important-info-body { font-size: 0.875rem; line-height: 1.5; color: var(--text); white-space: pre-wrap; }
.facility-important-info-body p { margin: 0 0 0.5em 0; }
.facility-important-info-body p:last-child { margin-bottom: 0; }
.facility-card-body { display: flex; gap: 0 24px; align-items: flex-start; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--line, #e5e7eb); }
.facility-card-sidemenu { flex-shrink: 0; width: 180px; display: flex; flex-direction: column; gap: 0; margin: 0; padding: 0; border-right: 1px solid var(--line, #e5e7eb); padding-right: 16px; }
.facility-sidemenu-item { display: block; width: 100%; padding: 8px 12px; margin: 0; text-align: left; font-size: 0.8125rem; font-weight: 500; color: var(--muted, #6b7280); background: transparent; border: none; border-radius: 6px; cursor: pointer; transition: all 0.15s; font-family: inherit; text-decoration: none; box-sizing: border-box; }
.facility-sidemenu-item:hover { color: var(--text, #111); background: rgba(0,0,0,0.04); }
.facility-sidemenu-item.active { color: #3b82f6; background: rgba(59,130,246,0.1); }
.facility-card-content { flex: 1; min-width: 0; }
.customer-tab-panel { display: none; }
.customer-tab-panel.active { display: block; }
.customer-section-header { margin-bottom: 12px; display: flex; flex-wrap: wrap; align-items: center; gap: 16px; }
.customer-section-header h2 { margin: 0; font-size: 0.9375rem; font-weight: 600; line-height: 1.3; }
.servicelogg-header { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
.servicelogg-type-filter { display: flex; align-items: center; gap: 8px; margin: 0; }
.servicelogg-type-label { margin: 0; font-size: 0.9375rem; font-weight: 600; color: var(--text, #111); line-height: 1.3; }
.servicelogg-type-select { padding: 6px 10px; border-radius: 8px; border: 1px solid var(--line, #e5e7eb); background: var(--card, #fff); color: var(--text, #111); font-size: 0.875rem; font-family: inherit; min-width: 160px; height: 32px; line-height: 1.3; vertical-align: middle; }
.servicelogg-type-select:focus { outline: none; border-color: #3b82f6; }
.facility-datasheets-toolbar { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-bottom: 12px; }
.facility-datasheets-search-label { font-size: 0.8125rem; color: var(--muted); margin: 0; line-height: 1; align-self: center; }
.facility-datasheets-search-input { width: 100%; max-width: 280px; padding: 6px 10px; font-size: 0.875rem; border: 1px solid var(--line); border-radius: 6px; background: var(--bg); color: var(--text); height: 32px; box-sizing: border-box; vertical-align: middle; }
.facility-datasheets-search-input:focus { outline: 2px solid var(--line); outline-offset: 2px; }
.facility-datasheets-count { font-size: 0.8125rem; color: var(--muted); }
.facility-datasheets-list { list-style: none; padding: 0; margin: 0; }
.facility-datasheet-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 8px 0; border-bottom: 1px solid var(--line); flex-wrap: wrap; }
.facility-datasheet-row.hidden { display: none; }
.facility-datasheet-title { font-size: 0.875rem; font-weight: 500; }
.facility-datasheet-actions { display: flex; gap: 8px; flex-shrink: 0; }
.facility-datasheet-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; font-size: 0.875rem; border-radius: 8px; text-decoration: none; background: var(--btn); color: var(--text); border: 1px solid var(--line); transition: background 0.2s, color 0.2s, border-color 0.2s; }
.facility-datasheet-btn:hover { background: var(--btnHover); }
.facility-datasheet-btn--secondary { background: transparent; color: var(--muted); }
.facility-datasheet-btn--secondary:hover { color: var(--text); border-color: var(--muted); }
.facility-datasheets-empty { margin-top: 8px; }
</style>

<script>
(function() {
  var hashToTab = { racks: 'racks', network: 'network', devices: 'devices', documents: 'documents', servicelogg: 'servicelogg', produktdatablader: 'produktdatablader', contacts: 'contacts' };
  function getHashTab() { var h = (window.location.hash || '').replace(/^#/, ''); return hashToTab[h] || 'contacts'; }
  function setActiveTab(tabId) {
    var sidemenuItems = document.querySelectorAll('.facility-sidemenu-item');
    var panels = document.querySelectorAll('.facility-card-content .customer-tab-panel');
    sidemenuItems.forEach(function(i) { i.classList.toggle('active', i.dataset.tab === tabId); });
    panels.forEach(function(p) { p.classList.toggle('active', p.id === 'tab-' + tabId); });
  }
  document.querySelectorAll('.facility-sidemenu-item').forEach(function(item) {
    item.addEventListener('click', function(e) { e.preventDefault(); var tab = this.dataset.tab; if (history.replaceState) history.replaceState(null, '', this.getAttribute('href') || ('#' + tab)); else window.location.hash = tab; setActiveTab(tab); });
  });
  window.addEventListener('hashchange', function() { setActiveTab(getHashTab()); });
  setActiveTab(getHashTab());
  var searchEl = document.getElementById('facility-datasheets-search');
  var listEl = document.getElementById('facility-datasheets-list');
  var countEl = document.getElementById('facility-datasheets-count');
  var emptyEl = document.getElementById('facility-datasheets-empty');
  if (searchEl && listEl) {
    function filterDatasheets() {
      var q = (searchEl.value || '').toLowerCase().trim();
      var rows = listEl.querySelectorAll('.facility-datasheet-row');
      var visible = 0;
      rows.forEach(function(row) { var name = (row.getAttribute('data-name') || '').toLowerCase(); var show = !q || name.indexOf(q) !== -1; row.classList.toggle('hidden', !show); if (show) visible++; });
      if (countEl) countEl.textContent = q ? (visible + ' / ' + rows.length) : '';
      if (emptyEl) emptyEl.hidden = visible > 0;
    }
    searchEl.addEventListener('input', filterDatasheets);
    searchEl.addEventListener('change', filterDatasheets);
  }
})();
</script>
