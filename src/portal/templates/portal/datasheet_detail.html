{% extends "portal/base.html" %}
{% load i18n static %}
{% block title %}{{ datasheet.title }} | {% trans "Product datasheet" %} | {% trans "PMG Portal" %}{% endblock %}

{% block content %}
<div class="datasheet-page">
  <!-- Breadcrumb: same structure as facility detail -->
  <div class="breadcrumb-row">
    <a href="/" class="breadcrumb-back-btn" aria-label="{% trans 'Back to Dashboard' %}" hx-get="/" hx-target="#main-content" hx-push-url="true">← {% trans "Dashboard" %}</a>
    <nav class="breadcrumb admin-breadcrumb" aria-label="Breadcrumb">
      <a href="/" hx-get="/" hx-target="#main-content" hx-push-url="true">{% trans "Dashboard" %}</a>
      <span class="breadcrumb-sep">→</span>
      <span>{% trans "Product datasheet" %}</span>
      <span class="breadcrumb-sep">→</span>
      <span>{{ datasheet.title }}</span>
    </nav>
  </div>

  <div class="datasheet-header-row">
    <div class="datasheet-header-main">
      <h1 class="datasheet-title">{{ datasheet.title }}</h1>
      <p class="datasheet-meta">
        {% trans "Created" %}: {{ datasheet.uploaded_at|date:"Y-m-d H:i" }}
        &nbsp;·&nbsp;
        {% trans "Last updated" %}: {{ datasheet.updated_at|date:"Y-m-d H:i" }}
      </p>
    </div>
    <div class="datasheet-actions">
      <a href="{% url 'datasheet_pdf' device_type.slug %}" class="datasheet-action-btn" title="{% trans 'Last ned .PDF' %}" aria-label="{% trans 'Last ned .PDF' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="M9 15l3 3 3-3"/></svg>
      </a>
      <button type="button" class="datasheet-action-btn" onclick="window.print()" title="{% trans 'Print datasheet' %}" aria-label="{% trans 'Print datasheet' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/></svg>
      </button>
      {% if datasheet.file %}
      <a href="{{ datasheet.file.url }}" target="_blank" rel="noopener" class="datasheet-action-btn" title="{% trans 'Last ned produsentens datablad' %}" aria-label="{% trans 'Last ned produsentens datablad' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      </a>
      {% endif %}
    </div>
  </div>

  <div class="datasheet-body print-datasheet">
    {% if content_html %}
    <div class="datasheet-content markdown-body">
      {{ content_html|safe }}
    </div>
    {% endif %}
    {% if datasheet.file and not content_html %}
    <p class="muted">{% trans "No Markdown content. Download the manufacturer PDF above." %}</p>
    {% endif %}
  </div>

  <footer class="datasheet-footer print-only">
    <p>© {{ datasheet.updated_at|date:"Y" }} Park Media Group AS</p>
  </footer>
</div>

<style>
/* Full width like portal dashboard – no extra max-width */
.datasheet-page { width: 100%; padding: 0; }

.datasheet-header-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 24px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}
.datasheet-header-main { flex: 1; min-width: 0; }
.datasheet-title { font-size: 1.75rem; margin: 0 0 0.5rem 0; }
.datasheet-meta { color: var(--muted); font-size: 0.9rem; margin: 0; }

/* Icon buttons: right-aligned, only as wide as icon needs */
.datasheet-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
  align-items: center;
}
.datasheet-action-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  padding: 0;
  border-radius: 8px;
  background: var(--bg-secondary, #f3f4f6);
  border: 1px solid var(--line, #d1d5db);
  color: var(--text);
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.datasheet-action-btn:hover {
  background: var(--line, #e5e7eb);
  border-color: var(--text);
  color: var(--text);
}
.datasheet-action-btn:focus {
  outline: 2px solid var(--link);
  outline-offset: 2px;
}

.datasheet-body { margin-top: 0; }
.markdown-body { line-height: 1.6; }
.markdown-body h1 { font-size: 1.5rem; margin-top: 1.5rem; }
.markdown-body h2 { font-size: 1.25rem; margin-top: 1.25rem; }
.markdown-body table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
.markdown-body th, .markdown-body td { border: 1px solid var(--line, #ddd); padding: 0.5rem 0.75rem; text-align: left; }
.markdown-body th { background: var(--bg-secondary, #f3f4f6); font-weight: 600; }

.datasheet-footer.print-only { display: none; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--line); font-size: 0.85rem; color: var(--muted); }

/* Avoid breaking tables/sections across pages (PDF + print) */
.markdown-body table,
.markdown-body h1,
.markdown-body h2,
.markdown-body h3 {
  page-break-inside: avoid;
}
.markdown-body h2 { page-break-after: avoid; }
.markdown-body h3 { page-break-after: avoid; }

@media print {
  /* Hide site chrome – print only the “PDF version” (content + copyright) */
  .topbar,
  .site-footer-wrapper,
  .footer,
  .breadcrumb-row,
  .datasheet-actions,
  .loading-indicator {
    display: none !important;
  }
  body { padding: 0; background: #fff; }
  .main-content { padding: 0; }
  .main-content .container { max-width: none; padding: 16px 24px; }
  .datasheet-page { padding: 0; }
  .datasheet-header-row { margin-bottom: 16px; }
  .print-only { display: block !important; }
  .datasheet-footer.print-only {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    text-align: center;
    padding: 8px 0;
    font-size: 0.85rem;
    color: #666;
    border-top: 1px solid #eee;
  }
}
</style>
{% endblock %}
