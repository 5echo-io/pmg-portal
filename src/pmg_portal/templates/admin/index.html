{% extends "admin/base.html" %}
{% load static %}
{% load i18n %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'app.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'admin_custom.css' %}">
<style>
/* INJECTED CSS - Loads last to override everything */
/* Force full width on dashboard - break out of ALL containers */
body.admin-page.dashboard #container,
body.admin-page.dashboard #main,
body.admin-page.dashboard #content,
body.admin-page.dashboard #content.colMS,
body.admin-page.dashboard #content.colMS-override {
  max-width: 100vw !important;
  width: 100vw !important;
  min-width: 100vw !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  float: none !important;
  box-sizing: border-box !important;
}

/* Hide or fix sidebar that constrains content */
body.admin-page.dashboard #changelist-filter,
body.admin-page.dashboard .sticky,
body.admin-page.dashboard .sticky-container,
body.admin-page.dashboard aside,
body.admin-page.dashboard [class*="sidebar"] {
  display: none !important;
}

/* Ensure content-wrapper breaks out and centers */
body.admin-page.dashboard #content .content-wrapper {
  max-width: 980px !important;
  width: 100% !important;
  margin-left: auto !important;
  margin-right: auto !important;
  padding: 0 !important;
  box-sizing: border-box !important;
}

/* Force dashboard-grid to use full available width */
body.admin-page.dashboard .dashboard-grid {
  display: grid !important;
  grid-template-columns: repeat(3, 1fr) !important;
  gap: 24px !important;
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
}

/* Hide breadcrumbs */
body.admin-page.dashboard .breadcrumbs {
  display: none !important;
}

/* Hide duplicate h1 */
body.admin-page.dashboard #content > h1:not(.content-wrapper h1) {
  display: none !important;
}

/* FORCE FOOTER FULL WIDTH - Match portal exactly */
body.admin-page.dashboard footer.footer,
body.admin-page.dashboard .footer,
body.admin-page footer.footer,
body.admin-page .footer,
footer.footer,
.footer {
  width: 100% !important;
  max-width: 100% !important;
  min-width: 100% !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  margin-top: auto !important;
  flex-shrink: 0 !important;
  padding: 30px 0 !important;
  border-top: 1px solid var(--line) !important;
  background: #0c1426 !important;
  box-sizing: border-box !important;
  position: relative !important;
}

/* Footer content should match portal exactly */
body.admin-page.dashboard .footer-content,
body.admin-page .footer-content,
.footer-content {
  max-width: 980px !important;
  width: 100% !important;
  margin-left: auto !important;
  margin-right: auto !important;
  padding-left: 20px !important;
  padding-right: 20px !important;
  box-sizing: border-box !important;
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
  gap: 30px !important;
}
</style>
{% endblock %}

{% block bodyclass %}{{ block.super }} admin-page dashboard{% endblock %}

{% block sidebar %}
{# Remove Recent Actions sidebar completely #}
{% endblock %}

{% block breadcrumbs %}
{# Remove breadcrumbs completely to avoid duplicate title #}
{% endblock %}

{% block content %}
{# Completely override Django admin's default content - fresh start #}
<div class="content-wrapper dashboard-page">
  <h1>Administration</h1>
  
  <div class="dashboard-grid">
    {% for app in app_list %}
      <div class="panel">
        <h2>
          <a href="{{ app.app_url }}" class="section-link" title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">
            {{ app.name }}
          </a>
        </h2>
        
        <ul class="list">
          {% for model in app.models %}
            <li class="list-item">
              <div class="list-title">
                {% if model.admin_url %}
                  <a href="{{ model.admin_url }}">{{ model.name }}</a>
                {% else %}
                  {{ model.name }}
                {% endif %}
              </div>
              <div class="list-actions">
                {% if model.add_url %}
                  <a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a>
                {% endif %}
                {% if model.admin_url %}
                  {% if model.view_only %}
                    <a href="{{ model.admin_url }}" class="viewlink">{% trans 'View' %}</a>
                  {% else %}
                    <a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a>
                  {% endif %}
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% empty %}
      <div class="panel">
        <p>{% trans "You don't have permission to view or edit anything." %}</p>
      </div>
    {% endfor %}
  </div>
</div>

<script>
// NUCLEAR OPTION: Completely override all width constraints
(function() {
  function nuclearWidthFix() {
    // Get all elements that might constrain width
    const elements = [
      document.getElementById('container'),
      document.getElementById('main'),
      document.getElementById('content'),
      document.querySelector('.colMS'),
      document.querySelector('.colSM'),
      document.querySelector('#changelist-filter'),
      document.querySelector('.sticky'),
      document.querySelector('.sticky-container'),
    ];
    
    elements.forEach(el => {
      if (el) {
        // Remove width-constraining classes
        el.classList.remove('colMS', 'colSM');
        
        // Force full viewport width
        if (el.id === 'container' || el.id === 'main' || el.id === 'content') {
          el.style.cssText = 'max-width: 100vw !important; width: 100vw !important; min-width: 100vw !important; margin-left: 0 !important; margin-right: 0 !important; padding-left: 0 !important; padding-right: 0 !important; float: none !important; box-sizing: border-box !important;';
        }
      }
    });
    
    // Hide any sidebars or filters
    const sidebars = document.querySelectorAll('#changelist-filter, .sticky, .sticky-container, aside[class*="sidebar"], [class*="sidebar"]');
    sidebars.forEach(sb => {
      if (sb && !sb.closest('.content-wrapper')) {
        sb.style.display = 'none';
      }
    });
    
    // Fix content-wrapper - centered with max-width
    const contentWrapper = document.querySelector('.content-wrapper');
    if (contentWrapper) {
      // Calculate available width (viewport minus padding)
      const viewportWidth = window.innerWidth;
      const maxContentWidth = Math.min(980, viewportWidth - 64); // 32px padding on each side
      contentWrapper.style.cssText = `max-width: ${maxContentWidth}px !important; width: 100% !important; margin-left: auto !important; margin-right: auto !important; padding: 0 !important; box-sizing: border-box !important;`;
    }
    
    // Fix dashboard-grid
    const dashboardGrid = document.querySelector('.dashboard-grid');
    if (dashboardGrid) {
      dashboardGrid.style.cssText = 'display: grid !important; grid-template-columns: repeat(3, 1fr) !important; gap: 24px !important; width: 100% !important; max-width: 100% !important; box-sizing: border-box !important;';
    }
    
    // Hide breadcrumbs and duplicate titles
    const breadcrumbs = document.querySelector('.breadcrumbs');
    if (breadcrumbs) breadcrumbs.style.display = 'none';
    
    const allH1s = document.querySelectorAll('#content h1');
    allH1s.forEach((h1, idx) => {
      if (idx > 0 && !h1.closest('.content-wrapper')) {
        h1.style.display = 'none';
      }
    });
    
    // NUCLEAR FOOTER FIX - Move outside ALL containers and force full width
    const footer = document.querySelector('footer.footer, .footer');
    if (footer) {
      // Move footer to body if it's inside any container
      const body = document.body;
      const container = document.getElementById('container');
      const main = document.getElementById('main');
      const content = document.getElementById('content');
      
      // Check if footer is inside any container
      if (footer.parentElement !== body) {
        // Move footer to body
        body.appendChild(footer);
      }
      
      // Force full viewport width using calc() trick
      footer.style.cssText = 'width: 100vw !important; max-width: 100vw !important; min-width: 100vw !important; margin-left: calc(-50vw + 50%) !important; margin-right: calc(-50vw + 50%) !important; margin-top: auto !important; flex-shrink: 0 !important; padding: 30px 0 !important; border-top: 1px solid var(--line) !important; background: #0c1426 !important; box-sizing: border-box !important; position: relative !important; left: 0 !important; right: 0 !important;';
      
      // Fix footer-content to match portal (max-width: 980px)
      const footerContent = footer.querySelector('.footer-content');
      if (footerContent) {
        footerContent.style.cssText = 'max-width: 980px !important; width: 100% !important; margin-left: auto !important; margin-right: auto !important; padding-left: 20px !important; padding-right: 20px !important; box-sizing: border-box !important; display: grid !important; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important; gap: 30px !important;';
      }
    }
    
    // Ensure body uses flexbox for footer positioning
    const bodyEl = document.body;
    if (bodyEl) {
      bodyEl.style.cssText = 'min-height: 100vh !important; display: flex !important; flex-direction: column !important; margin: 0 !important; padding: 0 !important; width: 100% !important; max-width: 100% !important;';
    }
    
    // Ensure html also uses full width
    const htmlEl = document.documentElement;
    if (htmlEl) {
      htmlEl.style.cssText = 'width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 0 !important;';
    }
    
    // Debug output
    console.log('=== DASHBOARD WIDTH FIX ===');
    console.log('Container width:', document.getElementById('container') ? window.getComputedStyle(document.getElementById('container')).width : 'N/A');
    console.log('Main width:', document.getElementById('main') ? window.getComputedStyle(document.getElementById('main')).width : 'N/A');
    console.log('Content width:', document.getElementById('content') ? window.getComputedStyle(document.getElementById('content')).width : 'N/A');
    console.log('Content-wrapper width:', contentWrapper ? window.getComputedStyle(contentWrapper).width : 'N/A');
    console.log('Footer width:', footer ? window.getComputedStyle(footer).width : 'N/A');
    console.log('Viewport width:', window.innerWidth);
  }
  
  // Run immediately
  nuclearWidthFix();
  
  // Run after DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', nuclearWidthFix);
  }
  
  // Run after all resources load
  window.addEventListener('load', nuclearWidthFix);
  
  // Run multiple times to catch late-loading CSS
  setTimeout(nuclearWidthFix, 0);
  setTimeout(nuclearWidthFix, 50);
  setTimeout(nuclearWidthFix, 100);
  setTimeout(nuclearWidthFix, 200);
  setTimeout(nuclearWidthFix, 300);
  setTimeout(nuclearWidthFix, 500);
  setTimeout(nuclearWidthFix, 1000);
  
  // Also run on resize to recalculate
  window.addEventListener('resize', nuclearWidthFix);
})();
</script>
{% endblock %}
