# Internationalization (i18n)

The portal supports **Norwegian (Bokmål)** and **English**. Users can switch language from:

- **Avatar menu** (when logged in): click the current language to open the dropdown, then choose the other language. The menu closes when the mouse leaves.
- **Login page**: footer on the right shows current language and a link to switch to the other language.

## For developers

When building the site further, **all user-facing text must be available in both Norwegian and English**.

### In Django templates

1. At the top of the template (or in a parent that already loads it): `{% load i18n %}`
2. Wrap every user-visible string in:
   - `{% trans "Your string here" %}` for static text
   - `{% blocktrans with var=value %}Text with {{ var }}{% endblocktrans %}` when the string contains variables

### Adding new translatable strings

1. Add the string in the template with `{% trans "..." %}` (English as the default).
2. Add the Norwegian translation in **`src/locale/nb/LC_MESSAGES/django.po`**:
   - Copy an existing `msgid`/`msgstr` block and set `msgid` to the exact English string and `msgstr` to the Norwegian translation.
3. Compile messages (from the **`src`** directory):
   ```bash
   python manage.py compilemessages
   ```
   This creates/updates `locale/nb/LC_MESSAGES/django.mo` from `django.po`. **Norwegian will not appear until the .mo file exists.** Restart the app if it is running.

### Extracting strings (optional)

To regenerate the `.po` file from all templates and Python code (e.g. after adding many new `trans` tags):

```bash
cd src
python manage.py makemessages -l nb --ignore=env
```

Then edit `locale/nb/LC_MESSAGES/django.po` to fill in the `msgstr` for each `msgid`, and run `compilemessages` as above.

### Language codes

- **en** – English (default)
- **nb** – Norwegian Bokmål

Settings: `LANGUAGE_CODE`, `LANGUAGES`, and `LOCALE_PATHS` in `pmg_portal/settings.py`. Language is stored in the session (Django’s `set_language` view).
